<!DOCTYPE html>
<html>

<head>
    <link href="https://unpkg.com/tabulator-tables@4.9.3/dist/css/tabulator.min.css" rel="stylesheet">
    <script type="text/javascript" src="https://unpkg.com/tabulator-tables@4.9.3/dist/js/tabulator.min.js"></script>
</head>

<body>

    <div id="locator">
    <p><h1>Click the button to get the five nearest food trucks in near you.</h1></p>
    <button onclick="getLocation()">Display Food Trucks</button>
    </div>

    <div id="data-table"></div>
    <script>

        var x = document.getElementById("locator");

        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(showPositionTrucks);
            } else {
                x.innerHTML = "Geolocation is not supported by this browser.";
            }
        }

        function showPositionTrucks(position) {
            x.innerHTML = "Your Location: <br> Latitude: " + position.coords.latitude +
                "&emsp;Longitude: " + position.coords.longitude + "<br><h2>The Nearest Five Food Trucks in San Francisco</h2>";
            const url = 'https://getsf-foodtrucks.azurewebsites.net/api/Get-SFFoodTrucks?code=Ha6RHHSTnGB7t6/PbsCskUQcO00twlVhfuTS5rnEnq8pnhEaAa/Hag==';
            var Http = new XMLHttpRequest();
            Http.open("POST", url, true);
            Http.setRequestHeader('Content-Type', 'application/json;charset=UTF-8');
            var req = '{"lat":"' + position.coords.latitude + '","long":"' + position.coords.longitude + '"}';
            Http.send(req);
            Http.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    var tableData = JSON.parse(this.responseText);
                    var table = new Tabulator("#data-table", {
                        data: tableData,
                        layout: "fitDataStretch",
                        virtualDomHoz: true,
                        columns: [
                            { title: "Name", field: "Applicant" },
                            { title: "Location", field: "Location", hozAlign: "center" },
                            { title: "Location Description", field: "LocationDescription", hozAlign: "left", sorter: "number" },
                            { title: "Food Items", field: "FoodItems", hozAlign: "left" },
                            //{ title: "Schedule", field: "Schedule", hozAlign: "left" },

                        ],
                    });
                    //console.log(tableData);
                    //console.log(typeof tableData);
                };
            }
        }
    </script>
</body>

</html>
